
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.4">
    
    
      
        <title>General Information - Free60 Wiki archive</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f7f47774.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#general-information" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Free60 Wiki archive" class="md-header__button md-logo" aria-label="Free60 Wiki archive" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Free60 Wiki archive
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              General Information
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Free60 Wiki archive" class="md-nav__button md-logo" aria-label="Free60 Wiki archive" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Free60 Wiki archive
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Category_Xbox360_Hardware/" class="md-nav__link">
        Hardware
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Category_Xbox360_System_Software/" class="md-nav__link">
        System Software
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Category_Xbox360_Homebrew_Software/" class="md-nav__link">
        Homebrew Software
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Category_Xbox360_Linux/" class="md-nav__link">
        Linux
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Category_Xbox360_Development/" class="md-nav__link">
        Development
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Category_Support/" class="md-nav__link">
        Support
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../%21TODO/" class="md-nav__link">
        ToDo
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#test-kits" class="md-nav__link">
    Test Kits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#obtaining-a-shadowboot-rom" class="md-nav__link">
    Obtaining a shadowboot ROM
  </a>
  
    <nav class="md-nav" aria-label="Obtaining a shadowboot ROM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iso-recoveries" class="md-nav__link">
    ISO Recoveries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-recoveries" class="md-nav__link">
    Remote Recoveries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="general-information">General Information</h1>
<p>Development kits have an undocumented, internal feature called 'shadow
booting' which allows them to enter an alternate boot chain during the
<a href="Boot_Process" title="wikilink">boot process</a>. By placing a specially crafted
file titled 'xboxromw2d.bin' on the root of the system's hard disk, on
bootup the system will start, begin the process, then reboot again,
finally completing the boot sequence having loaded from the bootloaders
from the file on disk. Shadowbooting allows you to apply patches to any
part of the system software stack from the 2BL up without reflashing the
NAND.</p>
<p>Once booted from shadowboot, the alternate bootloaders are loaded into
memory just the same as a normal boot sequence: analyzing a NAND dump
from a live shadow booted system (the flash dumped while the system is
running) shows the SB, SD, and SE bootloaders on the system.</p>
<p>Shadow booting has long been held a closely guarded secret within the
community, where only recently have its existence become widely known
due to their use with Xbox Live challenge bypass services.</p>
<h2 id="test-kits">Test Kits</h2>
<p>Unlike full development kits, test kits are limited in their ability to
do kernel debugging among other restrictions. Test kits run on a
different software stack than dev kits, and as such require their own
shadowboot during updates. ISO recoveries contain two shadowboot ROMs,
'xboxromw2d.bin' and 'xboxromtw2d.bin', which will initiate shadowboot
on dev and test kits, respectively.</p>
<h2 id="obtaining-a-shadowboot-rom">Obtaining a shadowboot ROM</h2>
<p>Shadowbooting is used in the recovery process.</p>
<h3 id="iso-recoveries">ISO Recoveries</h3>
<p>Open an ISO recovery with an archiver and you will find the
xboxromw2.bin and xboxromtw2.bin files. These are the "clean" shadowboot
sources from which we base our modifications.</p>
<h3 id="remote-recoveries">Remote Recoveries</h3>
<p>Remote recoveries also contain many shadowboot files (60 files) of
varying sizes.</p>
<h1 id="file-structure">File Structure</h1>
<p>Found in recovery images, shadowboot files are binaries titled
'xboxromw2d.bin' and 'xboxromtw2d.bin'. Full development kits will find
and boot from xboxromw2d.bin and test kits xboxromtw2d.bin. Shadowboot
files are always 832KB (851,968 bytes).</p>
<p>Structurally, shadowboot files are nearly identical to <a href="NAND_File_System" title="wikilink">flash
dumps</a>, but for obvious reasons they do not
contain mobiles or filesystems.</p>
<table>
<thead>
<tr>
<th>File Structure</th>
</tr>
</thead>
<tbody>
<tr>
<td>Section</td>
</tr>
<tr>
<td>File Header</td>
</tr>
<tr>
<td>SMC</td>
</tr>
<tr>
<td>Keyvault</td>
</tr>
<tr>
<td>2BL</td>
</tr>
<tr>
<td>3BL</td>
</tr>
<tr>
<td>4BL</td>
</tr>
<tr>
<td>5BL</td>
</tr>
</tbody>
</table>
<h2 id="file-header">File Header</h2>
<table>
<thead>
<tr>
<th>File Header</th>
</tr>
</thead>
<tbody>
<tr>
<td>Section</td>
</tr>
<tr>
<td>Magic bytes</td>
</tr>
<tr>
<td>Major Build</td>
</tr>
<tr>
<td>QFE?</td>
</tr>
<tr>
<td>Flags</td>
</tr>
<tr>
<td>SB offset</td>
</tr>
<tr>
<td>CF1 offset/Size?</td>
</tr>
<tr>
<td>Microsoft copyright</td>
</tr>
<tr>
<td>Padding</td>
</tr>
<tr>
<td>KV size?</td>
</tr>
<tr>
<td>CF1 offset?</td>
</tr>
<tr>
<td>Patch slots</td>
</tr>
<tr>
<td>KV version</td>
</tr>
<tr>
<td>KV offset</td>
</tr>
<tr>
<td>Patch slot size? Metadata style? (360FlashTool)</td>
</tr>
<tr>
<td>SMC config offset</td>
</tr>
<tr>
<td>SMC length</td>
</tr>
<tr>
<td>SMC offset</td>
</tr>
</tbody>
</table>
<p>On shadowboot ROMs the build number will be the major XDK flash version
(ie. 21250). On the hacked 16547 shadowboot ROM it is 16547 On a cold
flash dump, the build number will always be 1888.</p>
<p>On xboxromtw2 shadowboot ROMs, the SB offset is 0xc0000 whereas on both
normal ROMs and NAND dumps it is 0x8000</p>
<p>On NAND dumps the CF1 offset is 0x080000 while on shadowboot ROMs it is
0x0d000</p>
<p>The Microsoft copyright notice is as follows (ASCII) followed by a null
byte terminator (0x00)</p>
<p><code>Â© 2004-2011 Microsoft Corporation. All rights reserved.</code></p>
<p>Note that later NAND dumps may have updated the years in this string.</p>
<p>The unknown flag at 0x70 reads 0x0002(0000) on the NAND dump and
0x0001(0000) on the shadowboot ROMs</p>
<p>The 360FlashTool changelog notes the value at offset 0x71 as the
'metadata style,' where "0 = Original, 1 = New 16MB, 2 = Large Block"</p>
<ul>
<li>I am unsure about the size of all of the data after the copyright
    notice, and especially unsure of everything near 0x70.</li>
</ul>
<h2 id="keyvault">Keyvault</h2>
<p>The keyvault data section is entirely zeroed through, meaning that there
is no keyvault. The KV data is probably loaded into RAM on the first
startup sequence using the console's native bootloader's and may remain
untouched by the shadowboot bootloader.</p>
<h1 id="boot-process">Boot Process</h1>
<p>Development kernels contain a series of subroutines to find, validate
and execute shadowboot ROMs found on various media. The first subroutine
in this shadowboot process is
<a href="ExpTryToShadowBoot" title="wikilink">ExpTryToShadowBoot</a>, followed by
<a href="ExpTryToBootMediaKernel" title="wikilink">ExpTryToBootMediaKernel</a>,
<a href="KiShadowBoot" title="wikilink">KiShadowBoot</a>,
<a href="KiQuiesce" title="wikilink">KiQuiesce</a>, and finally
<a href="HvxShadowBoot" title="wikilink">HvxShadowBoot</a>.</p>
<p>The fact that these subroutines cannot be find in bootloaders prior to
SE implies that the system must fully reach the kernel before rebooting
into the shadow kernel.</p>
<h2 id="media">Media</h2>
<p>The shadowboot process will attempt to boot from media in the following
order</p>
<ol>
<li>Remote - ExpMediaKernelKdRemoteBuffer - "host:\\xboxromw2d.bin"</li>
<li>CDRROM - ExpMediaKernelCdRom0Buffer
    "\\Device\\CdRom0\\xboxromw2d.bin"</li>
<li>Flash - Flash media kernelExpMediaKernelFlashBuffer
    "\\Device\\FlashFs\\xboxromw2d.bin"</li>
<li>Hard disk - ExpMediaKernelHd0Buffer
    "\\Device\\Harddisk0\\Partition1\\xboxromw2d.bin"</li>
</ol>
<h1 id="security-measures">Security Measures</h1>
<h2 id="encryption-schema">Encryption Schema</h2>
<p>Shadowboot bootloaders use a very similar encryption schema to retails
with CB \&lt;=1920 but for the presence of SC. Beginning with CB 1920, the
retail CD bootloader encryption key also uses the CPU key, whereas SD on
shadowboot ROMs does not.</p>
<h3 id="rc4-key">RC4 Key</h3>
<p>Each bootloader holds a random 'salt' value that is used in the
calculation of its RC4 key.</p>
<p>The key is derived from a 'secret' from the previous bootloader's key,
originating from the hardcoded key in the 1BL. The key is the 16 (0x10)
byte truncated HMAC-SHA1 digest of the secret appended with a random
salt.</p>
<p><code>key = HMAC-SHA(previous_key + salt)[0:0x10]</code></p>
<p>The bootloader's 'payload' (everything after 0x20 for SB/CB,
SC,SD/CD,SE/CE,CG everything after 0x30 for CF) is encrypted with RC4.
The decryption process looks like:</p>
<p><code>decrypted = encrypted[0:0x10] + key + decrypt_RC4(key,
encrypted[0x20:]</code></p>
<h4 id="2bl-key">2BL Key</h4>
<p>As an example, you calculate the 2BL RC4 key by reading out its salt
from 0x10 to 0x20. Calculate the HMAC SHA of this salt using the 1BL key
as the secret. The RC4 key is the first 0x10 bytes of this digest.</p>
<h4 id="3bl-key">3BL Key</h4>
<p>The 3BL (SC) is the exception to the rule. Its key is not generated
using the RC4 key from the 2BL, but its secret is instead 0x10 null
bytes.</p>
<h4 id="4bl-key">4BL Key</h4>
<p>Calculate the 4BL RC4 key by reading out its salt from 0x10 to 0x20.
Calculate the HMAC SHA of this salt using the 3BL RC4 key as the secret.
The 4BL RC4 key is the first 0x10 bytes of this digest.</p>
<h4 id="5bl-key">5BL Key</h4>
<p>Calculate the 5BL RC4 key by reading out its salt from 0x10 to 0x20.
Calculate the HMAC SHA of this salt using the 4BL RC4 key as the secret.
The 5BL RC4 key is the first 0x10 bytes of this digest.</p>
<h2 id="signature">Signature</h2>
<p>There is a common misconception to shadowbooting where we are able to
replace everything from the 2BL onward. While shadowboot ROMs contain a
nearly complete NAND image, the 2BL (and subsequently the 3BL) are still
protected by signature checks with the 2BL private key.</p>
<p>The fundamental difference in bootloader security between retail and
devkit is the replacement of precomputed hashes in retail bootloaders,
where the only signature checks occur on 2BL, CB, and the 6BL, CF; on
devkits, most of these hash checks are instead replaced with signature
checks. On both the cold boot as well as shadowboot, the 2BL is verified
with a signature check, which subsequently verifies SD with a signature
check.</p>
<p><a href="Category_Xbox360_System_Software">Category:Xbox360 System Software</a></p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.febc23d1.min.js"></script>
      
    
  </body>
</html>