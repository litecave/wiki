
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.4">
    
    
      
        <title>Hypervisor - Free60 Wiki archive</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f7f47774.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hypervisor" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Free60 Wiki archive" class="md-header__button md-logo" aria-label="Free60 Wiki archive" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Free60 Wiki archive
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Hypervisor
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Free60 Wiki archive" class="md-nav__button md-logo" aria-label="Free60 Wiki archive" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Free60 Wiki archive
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Category_Xbox360_Hardware/" class="md-nav__link">
        Hardware
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Category_Xbox360_System_Software/" class="md-nav__link">
        System Software
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Category_Xbox360_Homebrew_Software/" class="md-nav__link">
        Homebrew Software
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Category_Xbox360_Linux/" class="md-nav__link">
        Linux
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Category_Xbox360_Development/" class="md-nav__link">
        Development
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Category_Support/" class="md-nav__link">
        Support
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../%21TODO/" class="md-nav__link">
        ToDo
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#note" class="md-nav__link">
    Note
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-a-hypervisor" class="md-nav__link">
    What is a Hypervisor?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    How It Works
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interrupt-vectors" class="md-nav__link">
    Interrupt Vectors
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cryptography" class="md-nav__link">
    Cryptography
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utility-functions" class="md-nav__link">
    Utility Functions
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="hypervisor">Hypervisor</h1>
<h2 id="note">Note</h2>
<p>Old notes on the Xbox 360 Hypervisor can be found here: <a href="Hypervisor_(Old_Notes)" title="wikilink">Hypervisor (Old
Notes)</a></p>
<h2 id="what-is-a-hypervisor">What is a Hypervisor?</h2>
<p>Like in the PS3, Microsoft protects the integrity of its system with a
<strong>Hypervisor</strong>. Using the virtualization technologies of today's
processors, a hypervisor can act as a small piece of code with even
higher privileges than the more complex operating system. In theory,
even potential flaws in the operating system cannot be exploited since
the hypervisor puts up additional restrictions.</p>
<p>In case of the Xbox 360, the hypervisor is responsible for encryption,
decryption and the enforcement of access restrictions on memory.</p>
<p>Thanks to the
<a href="http://www.securityfocus.com/archive/1/461489/30/0/threaded">work</a> of
an anonymous hacker, a flaw in the hypervisor has been discovered on
certain versions of the <a href="../Kernel">Xbox 360 kernel</a>, allowing
the injection of code, which has not been cryptographically signed by
Microsoft.</p>
<h2 id="how-it-works">How It Works</h2>
<p>The Hypervisor (HV) is primarily made up of a series of interrupt
vectors and system calls that are accompanied by a few cryptography
related helper sub-routines. On the 360, the main job of the HV is to
manage the security of the system and handle
encryption/crypto-signatures of files that will be run. Because of this,
the HV is only executed in Real-Mode, with the highest privileges.
Memory paging is disabled and the HV can access any memory space on the
system, including memory mapped devices, however code run from user-mode
(normal mode) cannot read or write to HV space. It is essential to
understand how the HV works to understand the lower level of software on
the xbox 360.</p>
<p>When an interrupt is generated by the CPU, it jumps to the corresponding
handler. When this occurs, the address of the instruction that generated
the interrupt is stored in SRR0 and the MSR before the interrupt
occurred is stored in SRR1 with bits 33-36 and bits 42-47 loaded with
data specific to the interrupt. For every interrupt, the CPU is sent
into Real Mode/privileged state, interrupts are the entrance to the HV.
Instruction and data relocation is disabled at this time.</p>
<p>When a return from interrupt (rfid) instruction occurs, it copies SRR1
to the MSR, synchronizes context, and jumps to the address stored in
SRR0. Unless the Interrupt modified the contents of SRR1, the program
will exit privileged state after the MSR is set.</p>
<p>All interrupts are ordered meaning while one is being handled, the CPU
will wait until it is finished before handling another. The exception to
this is the RESET and MACHINE_CHECK interrupts, these are unorded and
can take place at any time. If they occur while another interrupt is
being handled, SRR0 and SRR1 will be overwritten by the new handler and
context synchronization will be lost. During normal operation of the
Xbox 360, the RESET interrupt does not occur and the MACHINE_CHECK
interrupt is not recoverable.</p>
<h2 id="interrupt-vectors">Interrupt Vectors</h2>
<table>
<thead>
<tr>
<th>Vectors</th>
</tr>
</thead>
<tbody>
<tr>
<td>Offset</td>
</tr>
<tr>
<td>0x00000100</td>
</tr>
<tr>
<td>0x00000200</td>
</tr>
<tr>
<td>0x00000218</td>
</tr>
<tr>
<td>0x00000300</td>
</tr>
<tr>
<td>0x00000380</td>
</tr>
<tr>
<td>0x00000400</td>
</tr>
<tr>
<td>0x00000480</td>
</tr>
<tr>
<td>0x00000500</td>
</tr>
<tr>
<td>0x00000600</td>
</tr>
<tr>
<td>0x00000700</td>
</tr>
<tr>
<td>0x00000800</td>
</tr>
<tr>
<td>0x00000900</td>
</tr>
<tr>
<td>0x00000980</td>
</tr>
<tr>
<td>0x00000B9C</td>
</tr>
<tr>
<td>0x00000C00</td>
</tr>
<tr>
<td>0x00000D00</td>
</tr>
<tr>
<td>0x00000A5C</td>
</tr>
<tr>
<td>0x00000F20</td>
</tr>
<tr>
<td>0x00001600</td>
</tr>
<tr>
<td>0x00001700</td>
</tr>
<tr>
<td>0x00001800</td>
</tr>
</tbody>
</table>
<h2 id="cryptography">Cryptography</h2>
<p>Retail 17511 - These offsets are subject to change!</p>
<table>
<thead>
<tr>
<th>Cryptography Functions</th>
</tr>
</thead>
<tbody>
<tr>
<td>Offset</td>
</tr>
<tr>
<td>0x00020300</td>
</tr>
<tr>
<td>0x00023500</td>
</tr>
<tr>
<td>0x000226F0</td>
</tr>
<tr>
<td>0x00022738</td>
</tr>
<tr>
<td>0x00020520</td>
</tr>
<tr>
<td>0x0000A880</td>
</tr>
<tr>
<td>0x0000AD20</td>
</tr>
<tr>
<td>0x00022DB8</td>
</tr>
<tr>
<td>0x00022BD0</td>
</tr>
<tr>
<td>0x00022CF0</td>
</tr>
<tr>
<td>0x00023170</td>
</tr>
<tr>
<td>0x00023218</td>
</tr>
<tr>
<td>0x00020578</td>
</tr>
<tr>
<td>0x00020F00</td>
</tr>
<tr>
<td>0x00021210</td>
</tr>
<tr>
<td>0x00020EC8</td>
</tr>
<tr>
<td>0x000244D8</td>
</tr>
<tr>
<td>0x00024560</td>
</tr>
<tr>
<td>0x000211F0</td>
</tr>
<tr>
<td>0x00024AF0</td>
</tr>
<tr>
<td>0x00024A40</td>
</tr>
<tr>
<td>0x00024A98</td>
</tr>
<tr>
<td>0x000247D0</td>
</tr>
<tr>
<td>0x00020910</td>
</tr>
<tr>
<td>0x00024C68</td>
</tr>
<tr>
<td>0x00023108</td>
</tr>
<tr>
<td>0x00022E98</td>
</tr>
<tr>
<td>0x00023010</td>
</tr>
<tr>
<td>0x00023060</td>
</tr>
<tr>
<td>0x000200F8</td>
</tr>
<tr>
<td>0x00023008</td>
</tr>
<tr>
<td>0x00021128</td>
</tr>
<tr>
<td>0x00020D28</td>
</tr>
<tr>
<td>0x000211A8</td>
</tr>
<tr>
<td>0x00021240</td>
</tr>
<tr>
<td>0x00021840</td>
</tr>
<tr>
<td>0x00021BC8</td>
</tr>
<tr>
<td>0x000217C0</td>
</tr>
<tr>
<td>0x00021968</td>
</tr>
<tr>
<td>0x00021710</td>
</tr>
<tr>
<td>0x00021270</td>
</tr>
<tr>
<td>0x00021C08</td>
</tr>
<tr>
<td>0x00023278</td>
</tr>
<tr>
<td>0x00023330</td>
</tr>
<tr>
<td>0x00020550</td>
</tr>
<tr>
<td>0x00020250</td>
</tr>
<tr>
<td>0x00020468</td>
</tr>
<tr>
<td>0x000203A8</td>
</tr>
<tr>
<td>0x00024420</td>
</tr>
<tr>
<td>0x00020680</td>
</tr>
<tr>
<td>0x00000E14</td>
</tr>
</tbody>
</table>
<h2 id="utility-functions">Utility Functions</h2>
<table>
<thead>
<tr>
<th>Utility Functions</th>
</tr>
</thead>
<tbody>
<tr>
<td>Offset</td>
</tr>
<tr>
<td>0x00000384</td>
</tr>
<tr>
<td>0x00000398</td>
</tr>
<tr>
<td>0x000003C4</td>
</tr>
<tr>
<td>0x00000484</td>
</tr>
<tr>
<td>0x000004A8</td>
</tr>
<tr>
<td>0x000004D8</td>
</tr>
<tr>
<td>0x0000068C</td>
</tr>
<tr>
<td>0x000006A0</td>
</tr>
<tr>
<td>0x000006B4</td>
</tr>
<tr>
<td>0x000006CC</td>
</tr>
<tr>
<td>0x00000E14</td>
</tr>
<tr>
<td>0x00000EE4</td>
</tr>
<tr>
<td>0x00001804</td>
</tr>
<tr>
<td>0x000029E0</td>
</tr>
<tr>
<td>0x00003358</td>
</tr>
<tr>
<td>0x000033D8</td>
</tr>
<tr>
<td>0x00003620</td>
</tr>
<tr>
<td>0x00000000</td>
</tr>
</tbody>
</table>
<h1 id="invoking-the-hypervisor">Invoking The Hypervisor</h1>
<p>User-mode code can invoke the Hypervisor at any time through what is
called a system call(syscall). System calls are functions set up by the
Hypervisor that can preform various tasks on the system, for example
getting the value of a special cpu register or printing to the console's
post bus. When a system call is preformed, the cpu generates a syscall
interrupt and jumps to the appropriate handler. System calls are
described more here: <a href="../System_Calls">System Calls</a></p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.febc23d1.min.js"></script>
      
    
  </body>
</html>