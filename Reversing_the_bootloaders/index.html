
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.4">
    
    
      
        <title>Reversing the bootloaders - Free60 Wiki archive</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f7f47774.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#requirements" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Free60 Wiki archive" class="md-header__button md-logo" aria-label="Free60 Wiki archive" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Free60 Wiki archive
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reversing the bootloaders
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Free60 Wiki archive" class="md-nav__button md-logo" aria-label="Free60 Wiki archive" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Free60 Wiki archive
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Category_Xbox360_Hardware/" class="md-nav__link">
        Hardware
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Category_Xbox360_System_Software/" class="md-nav__link">
        System Software
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Category_Xbox360_Homebrew_Software/" class="md-nav__link">
        Homebrew Software
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Category_Xbox360_Linux/" class="md-nav__link">
        Linux
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Category_Xbox360_Development/" class="md-nav__link">
        Development
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Category_Support/" class="md-nav__link">
        Support
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../%21TODO/" class="md-nav__link">
        ToDo
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <p>Since there seems to be little to none documentation about this so I've
decided to write up a guide to help all the up-and-coming hackers in the
scene.</p>
<h1 id="requirements">Requirements</h1>
<ul>
<li>IDA Pro (This costs money, it's recommended you buy a license)</li>
<li>PPC Altivec plugin (ver. 1.8 is recommended)</li>
<li>Decrypted loader (1BL/CB(_A)/CB_B/CD/CF)</li>
<li>Kernel with symbols, find this at usual places (Also, match these up
    by the date modified and put the pdb in same folder as exe)</li>
</ul>
<h1 id="reversing">Reversing</h1>
<h2 id="finding-the-entrypoint">Finding the entrypoint</h2>
<p>The entrypoint of the loader is located at offset 0x8-0xC in the <a href="Bootloaders" title="wikilink">loader
header</a>, once you've found the entrypoint the
reversing can begin.</p>
<h2 id="analyzing-the-loader">Analyzing the loader</h2>
<p>Open the loader in IDA Pro and make sure it's loading as a binary file
with the processor type set to PowerPC: ppc. Once you've done that a
dialog should appear asking if you want it to be mapped to ROM or RAM,
leave this screen as it is and just press OK.
IDA will then notify you that since it's a binary file the entrypoint is
unknown, so press G to show the go to address screen and put in the
entrypoint you found earlier.
Press C to turn this entrypoint into code and start IDA's analysis. This
should only take a few seconds and then the entire bootloader should be
fully analyzed.</p>
<h2 id="finding-functions">Finding functions</h2>
<p>I wasn't going to post this publicly for fear of MS updating their
bootloaders to use different code, but I realized that keeping info back
is for kids.
Thankfully Microsoft use the same code for the most of the functions in
the bootloaders as they do in the kernel, if you have a copy of the
kernel and symbols (available in certain private SDKs..) you can just
find the functions in the kernel, copy the hex code for them (make sure
none of the branch instructions are in the code, as these use static
offsets) and search for that hex in the bootloader. If you've done it
correctly you should come across code in the bootloader which looks near
identical to the code in the kernel. Just rename the sub to what it's
called in the kernel and you've successfully "reversed" a section of the
bootloader :D</p>
<p>(also, before anyone complains to me about this I know this is the
"noob" way of doing it, but its much easier then having to trawl through
code)</p>
<h3 id="functions-used-by-the-bootloaders">Functions used by the bootloaders</h3>
<p>Note, this list is incomplete, I've only included functions used for
authentication/decompression here, also some loaders don't include all
these functions.</p>
<ul>
<li>LDICreateDecompression</li>
<li>LDIDecompress</li>
<li>LZX_Decode</li>
<li>LZX_DecodeInit</li>
<li>LZX_DecodeNewGroup</li>
<li>XeCryptBnDw_Copy</li>
<li>XeCryptBnQwBeSigDifference</li>
<li>XeCryptBnQwBeSigFormat</li>
<li>XeCryptBnQwNeCompare</li>
<li>XeCryptBnQwNeModInv</li>
<li>XeCryptBnQwNeModMul</li>
<li>XeCryptBnQw_Copy</li>
<li>XeCryptHmacSha</li>
<li>XeCryptHmacShaFinal</li>
<li>XeCryptHmacShaInit</li>
<li>XeCryptMemDiff</li>
<li>XeCryptRc4Ecb</li>
<li>XeCryptRc4Key</li>
<li>XeCryptRotSum</li>
<li>XeCryptRotSumSha</li>
<li>XeCryptShaFinal</li>
<li>XeCryptShaInit</li>
<li>XeCryptShaTransform</li>
<li>XeCryptShaUpdate</li>
</ul>
<h2 id="finding-authentication-procedures">Finding authentication procedures</h2>
<p>Almost all the authentication subs in the bootloaders use
XeCryptRotSumSha, once you've managed to find that function you can just
do "Jump to xref to operand..." to find them. The bootloader decryption
routines all use XeCryptRc4Ecb, if you find that you can find the
decryption routines quite easily.</p>
<h3 id="tips">Tips</h3>
<ul>
<li>If you see the value 0x3C0030 in the function, this is used during
    CF decryption/authentication. You've just found the function used to
    decrypt/auth CF.</li>
<li>li r3, 0 is used to return that the decryption/auth failed, if
    theres any branches to code which has this then that means the
    branch is only used if a check fails, if you want to make it so you
    can run the next bootloader unauthenticated you could just nop (60
    00 00 00) out all the branches to this code.</li>
<li>Patching the call to XeCryptRc4Ecb with nop will disable encryption
    for the next loader, this is what the glitch hack build.py does to
    the CB_B of slims, along with patching out the branch to the panic
    function.</li>
<li>All of the bootloaders have a function to handle post output during
    boot. If you find that function, you can follow its references and
    use the post codes from <a href="POST" title="wikilink">POST</a> to step through each
    bootloader and figure out what each one is doing.</li>
<li>Please keep in mind that the newest versions of the bootloaders had
    their post codes removed due to the RGH hack relying on them.</li>
</ul>
<h2 id="code-snippets">Code Snippets</h2>
<h3 id="panic">panic</h3>
<pre><code>panic:
     li    r0, 0         # Load Immediate
     mtspr CTRL, r0      # Move to sprg,
     b     panic         # Branch
</code></pre>
<h3 id="post-output">post output</h3>
<pre><code>#Sends the lowest byte of r4 to the post buffer
post:
    sldi    r4, r4, 56
    std r4, 0(r3)
    blr
</code></pre>
<h1 id="reversed-bootloaders">Reversed Bootloaders</h1>
<p>The following bootloaders have already been reversed and posted:</p>
<ul>
<li><a href="1bl_Code" title="wikilink">1bl Code</a></li>
<li><a href="CB_Code" title="wikilink">CB Code</a></li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.febc23d1.min.js"></script>
      
    
  </body>
</html>